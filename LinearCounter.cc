
#include "LinearCounter.h"

//------------------------------------------------------------------------------
// Name: LengthCounter
//------------------------------------------------------------------------------
LinearCounter::LinearCounter() : value_(0), reload_(0), control_(0), halt_(false)  {

}

//------------------------------------------------------------------------------
// Name: ~LengthCounter
//------------------------------------------------------------------------------
LinearCounter::~LinearCounter() {

}

//------------------------------------------------------------------------------
// Name: clock
//------------------------------------------------------------------------------
void LinearCounter::clock() {
	
	if(halt_) {
		value_ = reload_;
	} else if(value_ != 0) {
		--value_;
	}
	
	if(!control_) {
		halt_ = false;
	}
}

//------------------------------------------------------------------------------
// Name: set_control
//------------------------------------------------------------------------------
void LinearCounter::set_mode(uint8_t value) {
	control_ = (value & 0x80);
}

//------------------------------------------------------------------------------
// Name: set_reload
//------------------------------------------------------------------------------
void LinearCounter::set_reload(uint8_t value) {
	reload_ = value;
}

//------------------------------------------------------------------------------
// Name: halt
//------------------------------------------------------------------------------
void LinearCounter::halt() {
	halt_ = true;
}

//------------------------------------------------------------------------------
// Name: value
//------------------------------------------------------------------------------
uint8_t LinearCounter::value() const {
	return value_;
}

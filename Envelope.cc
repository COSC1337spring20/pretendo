
#include "Envelope.h"

//------------------------------------------------------------------------------
// Name: Envelope
//------------------------------------------------------------------------------
Envelope::Envelope() : start_(false), loop_(false), constant_(0), constant_volume_(0), counter_(0), divider_(0) {
}

//------------------------------------------------------------------------------
// Name: ~Envelope
//------------------------------------------------------------------------------
Envelope::~Envelope() {

}

//------------------------------------------------------------------------------
// Name: volume
//------------------------------------------------------------------------------
uint8_t Envelope::volume() const {
	if(constant_) {
		return constant_volume_;
	} else {
		return counter_;
	}
}

//------------------------------------------------------------------------------
// Name: set_loop
//------------------------------------------------------------------------------
void Envelope::set_loop(uint8_t value) {
	loop_ = value;
}

//------------------------------------------------------------------------------
// Name: set_constant
//------------------------------------------------------------------------------
void Envelope::set_constant(uint8_t value) {
	constant_ = value;
}

//------------------------------------------------------------------------------
// Name: start
//------------------------------------------------------------------------------
void Envelope::set_divider(uint8_t value) {

	constant_volume_ = value & 0x0f;
	if(!constant_) {
		divider_ = (value & 0x0f) + 1;		
	}
}

//------------------------------------------------------------------------------
// Name: start
//------------------------------------------------------------------------------
void Envelope::start() {
	start_ = true;
}

//------------------------------------------------------------------------------
// Name: clock
//------------------------------------------------------------------------------
void Envelope::clock() {
	if(!start_) {
		clock_divider();
	} else {
		start_   = false;
		counter_ = 15;
	}
}

//------------------------------------------------------------------------------
// Name: clock_divider
//------------------------------------------------------------------------------
void Envelope::clock_divider() {
	if(counter_) {
		--counter_;
	} else if(loop_) {
		counter_ = 15;
	}
}
